Index: app/src/main/java/com/example/rentit/MainActivityRegisterCar.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.example.rentit;\r\n\r\nimport androidx.annotation.NonNull;\r\nimport androidx.annotation.RequiresApi;\r\nimport androidx.appcompat.app.AppCompatActivity;\r\nimport androidx.core.app.ActivityCompat;\r\nimport androidx.core.util.Pair;\r\n\r\nimport android.Manifest;\r\nimport android.app.Dialog;\r\nimport android.app.ProgressDialog;\r\nimport android.content.Context;\r\nimport android.content.Intent;\r\nimport android.content.pm.PackageManager;\r\nimport android.icu.text.SimpleDateFormat;\r\nimport android.net.Uri;\r\nimport android.os.Build;\r\nimport android.os.Bundle;\r\nimport android.view.Menu;\r\nimport android.view.MenuInflater;\r\nimport android.view.MenuItem;\r\nimport android.view.View;\r\nimport android.widget.AdapterView;\r\nimport android.widget.ArrayAdapter;\r\nimport android.widget.Button;\r\nimport android.widget.EditText;\r\nimport android.widget.ImageView;\r\nimport android.widget.Spinner;\r\nimport android.widget.TextView;\r\nimport android.widget.Toast;\r\n\r\nimport com.bumptech.glide.Glide;\r\nimport com.google.android.gms.tasks.OnFailureListener;\r\nimport com.google.android.gms.tasks.OnSuccessListener;\r\nimport com.google.android.material.datepicker.MaterialDatePicker;\r\nimport com.google.android.material.datepicker.MaterialPickerOnPositiveButtonClickListener;\r\nimport com.google.android.material.dialog.MaterialAlertDialogBuilder;\r\nimport com.google.firebase.auth.FirebaseAuth;\r\nimport com.google.firebase.auth.FirebaseUser;\r\nimport com.google.firebase.database.DataSnapshot;\r\nimport com.google.firebase.database.DatabaseError;\r\nimport com.google.firebase.database.DatabaseReference;\r\nimport com.google.firebase.database.FirebaseDatabase;\r\nimport com.google.firebase.database.IgnoreExtraProperties;\r\nimport com.google.firebase.database.ValueEventListener;\r\nimport com.google.firebase.storage.FirebaseStorage;\r\nimport com.google.firebase.storage.StorageReference;\r\nimport com.google.firebase.storage.UploadTask;\r\n\r\n\r\nimport java.util.ArrayList;\r\nimport java.util.Calendar;\r\nimport java.util.Date;\r\nimport java.util.List;\r\nimport java.util.Locale;\r\nimport java.util.TimeZone;\r\n\r\n\r\npublic class MainActivityRegisterCar extends AppCompatActivity {\r\n    private RegisterInformation registerInformation;\r\n\r\n\r\n    private DatabaseReference cardRef2;\r\n    private DatabaseReference cardRef;\r\n\r\n    private ProgressDialog progressDialog;\r\n    private StorageReference mStorageRef;\r\n    private FirebaseAuth mAuth;\r\n    private FirebaseUser firebaseUser;\r\n\r\n    private TextView textViewWarnAll;\r\n    private TextView textViewWarnArea;\r\n    private TextView textViewWarnImage;\r\n\r\n\r\n    private CardCar cardCar = new CardCar();\r\n    private ArrayList<Uri> arrayListImageViewUri = new ArrayList<>();\r\n    private ArrayList<String> areaList = new ArrayList<>();\r\n    private ImageView imageViewTemp = null;\r\n    private Uri uri1 = null;\r\n    private Uri uri2 = null;\r\n    private Uri uri3 = null;\r\n    private Uri uri4 = null;\r\n    private Uri uriSave = null;\r\n    private int numImage = 0;\r\n\r\n\r\n    private ImageView imageView1;\r\n    private ImageView imageView2;\r\n    private ImageView imageView3;\r\n    private ImageView imageView4;\r\n    private EditText editTextCity;\r\n    private EditText editTextName;\r\n    private EditText editTextTypeCar;\r\n    private EditText editTextInsurance;\r\n    private EditText editTextYearCar;\r\n    private EditText editTextPriceForDay;\r\n    private EditText editTextPhone;\r\n\r\n    private EditText editTextRemarks;\r\n    private EditText editTextRejection;\r\n\r\n\r\n    private Button buttonRegister, buttonDelete, buttonUpdate;\r\n    private Button buttonMyPage;\r\n    private Spinner areaSpinner;\r\n\r\n    private String email;\r\n    private String key = \"ggg\";\r\n    private String key2 = \"vvv\";\r\n    private String keyCard = \"0\";\r\n\r\n    private int flagI;\r\n    private String url = \"\";\r\n    private String area = \"\";\r\n    private boolean flag = false;\r\n    private CardCar cardCarEdit;\r\n    private boolean flagEdit;\r\n    private boolean flagMain;\r\n    private boolean flagManagementCardsApprov;\r\n\r\n    private Bundle bundle;\r\n    private DatabaseReference mDatabase;\r\n    private String removeImage = \"\";\r\n    private int flagImageDeleteConfirmation = 0;\r\n\r\n\r\n    @Override\r\n    protected void onCreate(Bundle savedInstanceState) {\r\n        super.onCreate(savedInstanceState);\r\n        setContentView(R.layout.activity_main_register_car);\r\n\r\n        progressDialog = new ProgressDialog(this);\r\n        flagManagementCardsApprov = false;\r\n        flagEdit = false;\r\n        flagMain = false;\r\n        try {\r\n            bundle = getIntent().getExtras();\r\n            flagManagementCardsApprov = bundle.getBoolean(\"flagManagement\");\r\n        } catch (RuntimeException e) {\r\n        }\r\n        try {\r\n            bundle = getIntent().getExtras();\r\n            flagMain = bundle.getBoolean(\"flagMain\");\r\n        } catch (RuntimeException e) {\r\n        }\r\n        try {\r\n            bundle = getIntent().getExtras();\r\n            flagEdit = bundle.getBoolean(\"flagEdit\");\r\n        } catch (RuntimeException e) {\r\n        }\r\n\r\n\r\n        setTextViewWarn();\r\n        setEditTxtId();\r\n        if (flagEdit || flagMain) {\r\n            cardCarEdit = new CardCar();\r\n            setCard();\r\n            setTextCard();\r\n        }\r\n        mStorageRef = FirebaseStorage.getInstance().getReference();\r\n        mAuth = FirebaseAuth.getInstance();\r\n        firebaseUser = mAuth.getCurrentUser();\r\n        try {\r\n            if (!firebaseUser.getEmail().toString().isEmpty())\r\n                email = firebaseUser.getEmail().toString();\r\n            else {\r\n                email = firebaseUser.getPhoneNumber().toString();\r\n                editTextPhone.setText(email);\r\n            }\r\n        } catch (RuntimeException e) {\r\n            email = firebaseUser.getPhoneNumber().toString();\r\n            editTextPhone.setText(email);\r\n        }\r\n\r\n        progressDialog = new ProgressDialog(this);\r\n\r\n\r\n        setListSpinerArea();\r\n        setSpinerArea();\r\n\r\n        buttonDelete = findViewById(R.id.buttonDelete);\r\n        buttonMyPage = findViewById(R.id.buttonMyPage);\r\n        buttonRegister = findViewById(R.id.buttonReturnMainPage);\r\n\r\n        if (flagManagementCardsApprov) {\r\n            editTextRemarks.setHint(\"הסבר סירוב\");\r\n            editTextRejection = findViewById(R.id.editTextRejection);\r\n            if (cardCarEdit.getPermissionToPublish() == 0) {\r\n                buttonRegister.setText(\"אישור\");\r\n                buttonDelete.setText(\"סירוב\");\r\n                buttonDelete.setVisibility(View.VISIBLE);\r\n            } else {\r\n                email = cardCarEdit.getEmail();\r\n                buttonDelete.setText(\"מחיקת כרטיס\");\r\n                buttonDelete.setVisibility(View.VISIBLE);\r\n                buttonRegister.setVisibility(View.GONE);\r\n            }\r\n            buttonMyPage.setText(\"לעמוד שלי\");\r\n\r\n        }\r\n        if (flagEdit) {\r\n            buttonRegister.setText(\"לשינוי פרטים\");\r\n            buttonDelete = findViewById(R.id.buttonDelete);\r\n            buttonDelete.setVisibility(View.VISIBLE);\r\n        }\r\n        if (flagEdit || flagManagementCardsApprov) {\r\n            buttonDelete.setOnClickListener(new View.OnClickListener() {\r\n                @Override\r\n                public void onClick(View view) {\r\n                    if (!buttonDelete.getText().equals(\"מחיקת כרטיס\")) {\r\n                        cardsRejection();\r\n\r\n\r\n                    } else\r\n                        deleteCard();\r\n\r\n                }\r\n            });\r\n        }\r\n        if (flagMain && !flagManagementCardsApprov) {\r\n            buttonRegister.setVisibility(View.GONE);\r\n            buttonDelete = findViewById(R.id.buttonDelete);\r\n            buttonDelete.setVisibility(View.GONE);\r\n            buttonUpdate = findViewById(R.id.upgrade3);\r\n            buttonUpdate.setVisibility(View.GONE);\r\n            buttonMyPage.setText(\"לעמוד הראשי\");\r\n\r\n        }\r\n\r\n        buttonRegister.setOnClickListener(new View.OnClickListener() {\r\n            @RequiresApi(api = Build.VERSION_CODES.N)\r\n            @Override\r\n            public void onClick(View view) {\r\n                progressDialog.setMessage(\"שומר כרטיס אנא חכה להשלמת התהליך...\");\r\n\r\n                if (flagManagementCardsApprov) {\r\n                    cardsApprov();\r\n\r\n                } else {\r\n                    setWarnGone();\r\n\r\n\r\n                    setCardDetails();\r\n\r\n                    if (!flag) retrieveData();\r\n                }\r\n\r\n            }\r\n        });\r\n\r\n\r\n        if (!flagMain) {\r\n            imageView1.setOnClickListener(new View.OnClickListener() {\r\n                @Override\r\n                public void onClick(View view) {\r\n                    numImage = 1;\r\n                    if (flagEdit && flagImageDeleteConfirmation != 1) {\r\n                        dialogeImageDeleteConfirmation();\r\n                        //           removeImage = cardCarEdit.getImageViewArrayListName().get(0);\r\n                    }\r\n                    if (!flagEdit || flagImageDeleteConfirmation == 1) openImage(imageView1, uri1);\r\n\r\n                }\r\n            });\r\n            imageView2.setOnClickListener(new View.OnClickListener() {\r\n                @Override\r\n                public void onClick(View view) {\r\n                    numImage = 2;\r\n                    if (flagEdit && flagImageDeleteConfirmation != 1) {\r\n                        dialogeImageDeleteConfirmation();\r\n                        //           removeImage = cardCarEdit.getImageViewArrayListName().get(0);\r\n                    }\r\n                    if (!flagEdit || flagImageDeleteConfirmation == 1) openImage(imageView2, uri1);\r\n\r\n                }\r\n            });\r\n            imageView3.setOnClickListener(new View.OnClickListener() {\r\n                @Override\r\n                public void onClick(View view) {\r\n                    numImage = 3;\r\n                    if (flagEdit && flagImageDeleteConfirmation != 1) {\r\n                        dialogeImageDeleteConfirmation();\r\n                        //           removeImage = cardCarEdit.getImageViewArrayListName().get(0);\r\n                    }\r\n                    if (!flagEdit || flagImageDeleteConfirmation == 1) openImage(imageView3, uri1);\r\n\r\n                }\r\n            });\r\n            imageView4.setOnClickListener(new View.OnClickListener() {\r\n                @Override\r\n                public void onClick(View view) {\r\n                    numImage = 4;\r\n                    if (flagEdit && flagImageDeleteConfirmation != 1) {\r\n                        dialogeImageDeleteConfirmation();\r\n                        //           removeImage = cardCarEdit.getImageViewArrayListName().get(0);\r\n                    }\r\n                    if (!flagEdit || flagImageDeleteConfirmation == 1) openImage(imageView4, uri1);\r\n\r\n                }\r\n            });\r\n        }\r\n//        Calendar calendar = Calendar.getInstance(TimeZone.getTimeZone(\"UTC\"));\r\n//        calendar.clear();\r\n//        Long today = MaterialDatePicker.todayInUtcMilliseconds();\r\n\r\n        MaterialDatePicker.Builder<Pair<Long, Long>> builder = MaterialDatePicker.Builder.dateRangePicker();\r\n        // MaterialDatePicker.Builder builder=MaterialDatePicker.Builder.dateRangePicker();\r\n        builder.setTitleText(\"בחר תאריך\");\r\n        final MaterialDatePicker materialDatePicker = builder.build();\r\n\r\n        final Button buttonData = findViewById(R.id.buttonDate);\r\n        buttonData.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View view) {\r\n                materialDatePicker.show(getSupportFragmentManager(), \"DATE_PICKER\");\r\n\r\n            }\r\n        });\r\n\r\n        materialDatePicker.addOnPositiveButtonClickListener(new MaterialPickerOnPositiveButtonClickListener() {\r\n            @RequiresApi(api = Build.VERSION_CODES.N)\r\n            @Override\r\n            public void onPositiveButtonClick(Object selection) {\r\n                Pair selectedDates = (Pair) materialDatePicker.getSelection();\r\n//              then obtain the startDate & endDate from the range\r\n                final Pair<Date, Date> rangeDate = new Pair<>(new Date((Long) selectedDates.first), new Date((Long) selectedDates.second));\r\n//              assigned variables\r\n                Date startDate = rangeDate.first;\r\n                Date endDate = rangeDate.second;\r\n//              Format the dates in ur desired display mode\r\n\r\n                SimpleDateFormat simpleFormat = new SimpleDateFormat(\"dd/MM/yyyy\", Locale.US);\r\n//              Display it by setText\r\n                cardCar.setDateStart(simpleFormat.format(startDate).toString());\r\n                cardCar.setDateEnd(simpleFormat.format(endDate).toString());\r\n\r\n                buttonData.setTextColor((int)R.color.colorBlack);\r\n                buttonData.setText(\" \" + simpleFormat.format(startDate) + \" Second : \" + simpleFormat.format(endDate));\r\n\r\n            }\r\n        });\r\n\r\n        buttonMyPage.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View view) {\r\n\r\n                Intent intent = new Intent(MainActivityRegisterCar.this, MainActivityPageUser.class);\r\n                startActivity(intent);\r\n\r\n            }\r\n        });\r\n\r\n    }\r\n\r\n\r\n    private void cardsApprov() {\r\n        cardCarEdit.setPermissionToPublish(1);\r\n        DatabaseReference ref = FirebaseDatabase.getInstance().getReference(\"CardsApprov\").push();\r\n        final String keyApprov = ref.getKey();\r\n        DatabaseReference ref2 = FirebaseDatabase.getInstance().getReference(\"CardsWaitApprov\");\r\n        ref2.child(cardCarEdit.getKey()).removeValue();\r\n        cardCarEdit.setKey(keyApprov);\r\n        ref.setValue(cardCarEdit);\r\n\r\n        DatabaseReference ref3 = FirebaseDatabase.getInstance().getReference(\"RegisterInformation\");\r\n        ref3.orderByChild(\"email\").equalTo(cardCarEdit.getEmail()).addListenerForSingleValueEvent(new ValueEventListener() {\r\n            @Override\r\n            public void onDataChange(@NonNull DataSnapshot snapshot) {\r\n                // Toast.makeText(MainActivityRegisterCar.this, snapshot.toString(), Toast.LENGTH_LONG).show();\r\n                for (DataSnapshot child : snapshot.getChildren()) {\r\n                    registerInformation = child.getValue(RegisterInformation.class);\r\n                    key2 = child.getKey();\r\n                }\r\n                //  editTextRemarks.setText(\"lll\" + registerInformation.getEmail());\r\n\r\n                List<CardCar> cardCarList = registerInformation.getCardsUser();\r\n                for (int j = 0; j < cardCarList.size(); j++) {\r\n                    if (cardCarList.get(j).getId() == cardCarEdit.getId()) {\r\n                        registerInformation.getCardsUser().get(j).setPermissionToPublish(1);\r\n                        registerInformation.getCardsUser().get(j).setKey(keyApprov);\r\n                        // editTextRemarks.setText(\"lll\" + registerInformation.getCardsUser().get(j).getPermissionToPublish());\r\n                        break;\r\n                    }\r\n                }\r\n                DatabaseReference cardR = FirebaseDatabase.getInstance().getReference();\r\n                cardR.child(\"RegisterInformation\").child(key2).setValue(registerInformation);\r\n                progressDialog.dismiss();\r\n                Intent intent = new Intent(MainActivityRegisterCar.this, MainActivityPageUser.class);\r\n                startActivity(intent);\r\n\r\n\r\n            }\r\n\r\n            @Override\r\n            public void onCancelled(@NonNull DatabaseError error) {\r\n\r\n            }\r\n        });\r\n\r\n    }\r\n\r\n    private void cardsRejection() {\r\n        cardCarEdit.setRejection(editTextRemarks.getText().toString());\r\n        cardCarEdit.setPermissionToPublish(2);\r\n        DatabaseReference ref = FirebaseDatabase.getInstance().getReference(\"CardsRejection\").push();\r\n        final String keyRejection = ref.getKey();\r\n        DatabaseReference ref2 = FirebaseDatabase.getInstance().getReference(\"CardsWaitApprov\");\r\n        ref2.child(cardCarEdit.getKey()).removeValue();\r\n        cardCarEdit.setKey(keyRejection);\r\n        ref.setValue(cardCarEdit);\r\n\r\n\r\n        DatabaseReference cardRef2 = FirebaseDatabase.getInstance().getReference(\"RegisterInformation\");\r\n\r\n        cardRef2.orderByChild(\"email\").equalTo(cardCarEdit.getEmail()).addListenerForSingleValueEvent(new ValueEventListener() {\r\n            @Override\r\n            public void onDataChange(@NonNull DataSnapshot snapshot) {\r\n                // Toast.makeText(MainActivityRegisterCar.this, snapshot.toString(), Toast.LENGTH_LONG).show();\r\n                //   editTextRemarks.setText(snapshot.toString());\r\n                for (DataSnapshot child : snapshot.getChildren()) {\r\n                    registerInformation = child.getValue(RegisterInformation.class);\r\n                    key2 = child.getKey();\r\n                }\r\n\r\n\r\n                List<CardCar> cardCarList = registerInformation.getCardsUser();\r\n                for (int j = 0; j < cardCarList.size(); j++) {\r\n                    if (cardCarList.get(j).getId() == cardCarEdit.getId()) {\r\n                        registerInformation.getCardsUser().get(j).setPermissionToPublish(2);\r\n                        registerInformation.getCardsUser().get(j).setRejection(\r\n                                editTextRemarks.getText().toString());\r\n\r\n                        registerInformation.getCardsUser().get(j).setKey(keyRejection);\r\n                        break;\r\n                    }\r\n                }\r\n                DatabaseReference cardR = FirebaseDatabase.getInstance().getReference();\r\n                cardR.child(\"RegisterInformation\").child(key2).setValue(registerInformation);\r\n\r\n                Intent intent = new Intent(MainActivityRegisterCar.this, MainActivityPageUser.class);\r\n                startActivity(intent);\r\n\r\n\r\n            }\r\n\r\n            @Override\r\n            public void onCancelled(@NonNull DatabaseError error) {\r\n\r\n            }\r\n        });\r\n\r\n    }\r\n\r\n\r\n    private void setTextCard() {\r\n        List<String> urlImage = cardCarEdit.getImageViewArrayListName();\r\n        cardCar.setImageViewArrayListName(urlImage);\r\n        Glide.with(this).load(urlImage.get(0)).into(imageView4);\r\n        if (urlImage.size() > 1) {\r\n            Glide.with(this).load(urlImage.get(1)).into(imageView2);\r\n        }\r\n        if (urlImage.size() > 2) {\r\n            Glide.with(this).load(urlImage.get(2)).into(imageView3);\r\n        }\r\n        if (urlImage.size() > 3) {\r\n            Glide.with(this).load(urlImage.get(3)).into(imageView1);\r\n        }\r\n\r\n\r\n        editTextCity.setText(cardCarEdit.getCity());\r\n        editTextName.setText(cardCarEdit.getName());\r\n        editTextTypeCar.setText(cardCarEdit.getTypeCar());\r\n        editTextInsurance.setText(cardCarEdit.getInsurance());\r\n        editTextYearCar.setText(cardCarEdit.getYearCar());\r\n        editTextPriceForDay.setText(cardCarEdit.getPriceDay());\r\n        editTextPhone.setText(cardCarEdit.getPhone());\r\n        Button buttonDate = findViewById(R.id.buttonDate);\r\n        buttonDate.setText(\"מ-\" + cardCarEdit.getDateStart() + \" עד-\" + cardCarEdit.getDateEnd());\r\n        cardCar.setDateEnd(cardCarEdit.getDateEnd());\r\n        cardCar.setDateStart(cardCarEdit.getDateStart());\r\n        editTextRemarks.setText(cardCarEdit.getRemarks());\r\n        if (cardCarEdit.getPermissionToPublish() == 2 && cardCarEdit.getRejection().length() > 0) {\r\n            editTextRemarks.setText(\"סורב מפני: \" + cardCarEdit.getRejection());\r\n            editTextRemarks.setTextColor(-65536);\r\n        }\r\n    }\r\n\r\n    private void setEditTxtId() {\r\n        imageView1 = findViewById(R.id.image13);\r\n        imageView2 = findViewById(R.id.image23);\r\n        imageView3 = findViewById(R.id.image33);\r\n        imageView4 = findViewById(R.id.image43);\r\n        editTextCity = findViewById(R.id.city3);\r\n        editTextName = findViewById(R.id.nameMen3);\r\n        editTextTypeCar = findViewById(R.id.typeCar3);\r\n        editTextInsurance = findViewById(R.id.insurance3);\r\n        editTextYearCar = findViewById(R.id.yearCar3);\r\n        editTextPriceForDay = findViewById(R.id.manyDay3);\r\n        editTextPhone = findViewById(R.id.phone3);\r\n        editTextRemarks = findViewById(R.id.remarksRegisterCar3);\r\n    }\r\n\r\n    private void setWarnGone() {\r\n        textViewWarnAll.setVisibility(View.GONE);\r\n        textViewWarnArea.setVisibility(View.GONE);\r\n        textViewWarnImage.setVisibility(View.GONE);\r\n\r\n\r\n\r\n    }\r\n\r\n    private void setTextViewWarn() {\r\n\r\n        textViewWarnAll = findViewById(R.id.warnAll);\r\n        textViewWarnArea = findViewById(R.id.warnArea);\r\n        textViewWarnImage = findViewById(R.id.warnImage);\r\n\r\n    }\r\n\r\n\r\n    @RequiresApi(api = Build.VERSION_CODES.N)\r\n    private void setCardDetails() {\r\n        flag = false;\r\n        boolean flag2 = false;\r\n\r\n        if (!flagEdit) {\r\n            flag2 = ErrWarn.errImage(arrayListImageViewUri.size(), textViewWarnImage);//TODO:b\r\n            if (!flag && flag2) flag = true;\r\n        }\r\n\r\n        flag2 = ErrWarn.errArea(area, textViewWarnArea);\r\n        if (!flag && flag2) flag = true;\r\n        cardCar.setArea(area);\r\n\r\n        String edit = editTextName.getText().toString();\r\n        flag2 = ErrWarn.errName(edit, editTextName);\r\n        if (!flag && flag2) flag = true;\r\n        cardCar.setName(edit);\r\n\r\n        edit = editTextCity.getText().toString();\r\n        flag2 = ErrWarn.errCity(edit, editTextCity);\r\n        if (!flag && flag2) flag = true;\r\n        cardCar.setCity(edit);\r\n\r\n        edit = cardCar.getDateStart();\r\n        if (edit.length() == 0||MainActivityManagementCardsApprov.passDate(edit)) {//TODO: HERE\r\n            flag2 = true;\r\n            Button button = findViewById(R.id.buttonDate);\r\n            button.setTextColor(-65536);\r\n            button.setText(\"אנא הכנס תאריכים תקינים\");\r\n        }\r\n        if (!flag && flag2) flag = true;\r\n\r\n\r\n        edit = editTextInsurance.getText().toString();\r\n        flag2 = ErrWarn.errInsurance(edit, editTextInsurance);\r\n        if (!flag && flag2) flag = true;\r\n        cardCar.setInsurance(edit);\r\n\r\n        edit = editTextPhone.getText().toString();\r\n        flag2 = ErrWarn.errPhone(edit, editTextPhone);\r\n        if (!flag && flag2) flag = true;\r\n        cardCar.setPhone(edit);\r\n\r\n        edit = editTextPriceForDay.getText().toString();\r\n        flag2 = ErrWarn.errPrice(edit, editTextPriceForDay);\r\n        if (!flag && flag2) flag = true;\r\n        cardCar.setPriceDay(edit);\r\n\r\n\r\n        edit = editTextTypeCar.getText().toString();\r\n        flag2 = ErrWarn.errTypeCar(edit, editTextTypeCar);\r\n        if (!flag && flag2) flag = true;\r\n        cardCar.setTypeCar(edit);\r\n\r\n        edit = editTextYearCar.getText().toString();\r\n        flag2 = ErrWarn.errYearCar(edit, editTextYearCar);\r\n        if (!flag && flag2) flag = true;\r\n        cardCar.setYearCar(edit);\r\n\r\n        if (flag) {\r\n            textViewWarnAll.setText(\"אחד הנתונים לא תקין\");\r\n            textViewWarnAll.setVisibility(View.VISIBLE);\r\n        }\r\n    }\r\n\r\n    public void openImage(ImageView imageView, Uri uri) {\r\n        imageViewTemp = imageView;\r\n        uriSave = uri;\r\n\r\n\r\n        try {\r\n            if (ActivityCompat.checkSelfPermission(MainActivityRegisterCar.this, Manifest.permission.READ_EXTERNAL_STORAGE) != PackageManager.PERMISSION_GRANTED) {\r\n                ActivityCompat.requestPermissions(MainActivityRegisterCar.this, new String[]{Manifest.permission.READ_EXTERNAL_STORAGE, Manifest.permission.WRITE_EXTERNAL_STORAGE}, 1);\r\n            } else {\r\n                Intent pickPhoto = new Intent(Intent.ACTION_PICK,\r\n                        android.provider.MediaStore.Images.Media.EXTERNAL_CONTENT_URI);\r\n                startActivityForResult(pickPhoto, 1);\r\n            }\r\n        } catch (Exception e) {\r\n            e.printStackTrace();\r\n        }\r\n\r\n    }\r\n\r\n    @Override\r\n    protected void onActivityResult(int requestCode, int resultCode, Intent imageReturnedIntent) {\r\n        super.onActivityResult(requestCode, resultCode, imageReturnedIntent);\r\n        switch (requestCode) {\r\n            case 0:\r\n                if (resultCode == RESULT_OK) {\r\n                    Uri selectedImage = imageReturnedIntent.getData();\r\n                    imageViewTemp.setImageURI(selectedImage);\r\n                    setUriImage(selectedImage);\r\n                    arrayListImageViewUri.add(selectedImage);\r\n\r\n                }\r\n\r\n                break;\r\n            case 1:\r\n                if (resultCode == RESULT_OK) {\r\n                    Uri selectedImage = imageReturnedIntent.getData();\r\n                    imageViewTemp.setImageURI(selectedImage);\r\n                    setUriImage(selectedImage);\r\n                    arrayListImageViewUri.add(selectedImage);\r\n\r\n\r\n                }\r\n                break;\r\n        }\r\n    }\r\n\r\n    private void setUriImage(Uri selectedImage) {\r\n        if (numImage == 1)\r\n            uri1 = selectedImage;\r\n        if (numImage == 2)\r\n            uri2 = selectedImage;\r\n        if (numImage == 3)\r\n            uri3 = selectedImage;\r\n        if (numImage == 4)\r\n            uri4 = selectedImage;\r\n    }\r\n\r\n\r\n    public void setListSpinerArea() {\r\n        areaSpinner = findViewById(R.id.spinnerArea3);\r\n        if (flagEdit) areaList.add(cardCarEdit.getArea());\r\n        else areaList.add(\"בחר אזור\");\r\n        areaList.add(\"צפון\");\r\n        areaList.add(\"מרכז\");\r\n        areaList.add(\"דרום\");\r\n        ArrayAdapter<String> areaAdapter = new ArrayAdapter<>(this,\r\n                android.R.layout.simple_spinner_dropdown_item, areaList);\r\n        areaSpinner.setAdapter(areaAdapter);\r\n    }\r\n\r\n    public void setSpinerArea() {\r\n        areaSpinner.setOnItemSelectedListener(new AdapterView.OnItemSelectedListener() {\r\n            @Override\r\n            public void onItemSelected(AdapterView<?> adapterView, View view, int i, long l) {\r\n                area = areaList.get(i);\r\n            }\r\n\r\n            @Override\r\n            public void onNothingSelected(AdapterView<?> adapterView) {\r\n\r\n            }\r\n        });\r\n\r\n    }\r\n\r\n\r\n    public void retrieveData() {\r\n        //  progressDialog = new ProgressDialog(this);\r\n\r\n        progressDialog.show();\r\n\r\n        cardRef = FirebaseDatabase.getInstance().getReference();\r\n        cardRef2 = FirebaseDatabase.getInstance().getReference(\"RegisterInformation\");\r\n\r\n        cardRef2.orderByChild(\"email\").equalTo(email).addListenerForSingleValueEvent(new ValueEventListener() {\r\n            @Override\r\n            public void onDataChange(@NonNull DataSnapshot dataSnapshot) {\r\n\r\n                for (DataSnapshot child : dataSnapshot.getChildren()) {\r\n                    registerInformation = child.getValue(RegisterInformation.class);\r\n                    key2 = child.getKey();\r\n\r\n                }\r\n\r\n                arrayListImageViewUri = new ArrayList<>();\r\n                if (uri4 != null) arrayListImageViewUri.add(uri4);\r\n                if (uri1 != null) arrayListImageViewUri.add(uri1);\r\n                if (uri2 != null) arrayListImageViewUri.add(uri2);\r\n                if (uri3 != null) arrayListImageViewUri.add(uri3);\r\n\r\n\r\n                cardCar.setId(registerInformation.getId());\r\n                upladUriFirebase();\r\n\r\n            }\r\n\r\n            @Override\r\n            public void onCancelled(@NonNull DatabaseError databaseError) {\r\n\r\n            }\r\n        });\r\n\r\n    }\r\n\r\n\r\n    public void upladUriFirebase() {\r\n        cardCar.setEmail(email);\r\n        cardCar.setNumImage(arrayListImageViewUri.size());\r\n\r\n        registerInformation.setId(registerInformation.getId() + 1);\r\n\r\n        flagI = 0;\r\n        //  final int length = arrayListImageViewUri.size();\r\n        if (flagEdit && flagImageDeleteConfirmation != 1) {\r\n            DatabaseReference cardRef5 = FirebaseDatabase.getInstance().getReference(\"CardsWaitApprov\").push();\r\n            cardCar.setKey(cardRef5.getKey());\r\n            cardRef5.setValue(cardCar);\r\n            registerInformation.addCardcar(cardCar);\r\n            DatabaseReference cardRef7 = FirebaseDatabase.getInstance().getReference();\r\n            cardRef7.child(\"RegisterInformation\").child(key2).setValue(registerInformation);\r\n\r\n            Toast.makeText(MainActivityRegisterCar.this, \"כרטיס נשמר בהצלחה\", Toast.LENGTH_SHORT).show();\r\n\r\n            deleteCard();\r\n        } else {\r\n            //  for (i = 0; i < length && i < 4; i++) {\r\n\r\n\r\n            imageAndSave(1);\r\n\r\n        }\r\n    }\r\n\r\n    private void imageAndSave(final int num) {\r\n\r\n        String s = registerInformation.getEmail() + \"/\" + registerInformation.getId() + \"\" + num + \".jpg\";\r\n        StorageReference riversRef = mStorageRef.child(s);\r\n        riversRef.putFile(arrayListImageViewUri.get(num - 1))\r\n                .addOnSuccessListener(new OnSuccessListener<UploadTask.TaskSnapshot>() {\r\n                    @Override\r\n                    public void onSuccess(UploadTask.TaskSnapshot taskSnapshot) {\r\n\r\n                        taskSnapshot.getStorage().getDownloadUrl().addOnSuccessListener(new OnSuccessListener<Uri>() {\r\n                            @Override\r\n                            public void onSuccess(Uri uri) {\r\n                                url = uri.toString();\r\n                                cardCar.addImageViewArrayListName(url);\r\n                                if (arrayListImageViewUri.size() == num) {\r\n                                    fireBase();\r\n                                    return;\r\n                                }\r\n                                imageAndSave(num + 1);\r\n\r\n                            }\r\n                        });\r\n                    }\r\n                })\r\n                .addOnFailureListener(new OnFailureListener() {\r\n                    @Override\r\n                    public void onFailure(@NonNull Exception exception) {\r\n                        Toast.makeText(MainActivityRegisterCar.this, \"תמונה לא נשמרה\", Toast.LENGTH_SHORT).show();\r\n                    }\r\n                });\r\n\r\n    }\r\n\r\n    private void fireBase() {\r\n        DatabaseReference cardRef4 = FirebaseDatabase.getInstance().getReference(\"CardsWaitApprov\").push();\r\n        keyCard = cardRef4.getKey();\r\n        cardCar.setKey(keyCard);\r\n        registerInformation.addCardcar(cardCar);\r\n        cardRef4.setValue(cardCar);\r\n\r\n        DatabaseReference cardRef6 = FirebaseDatabase.getInstance().getReference();\r\n        cardRef6.child(\"RegisterInformation\").child(key2).setValue(registerInformation);\r\n        Toast.makeText(MainActivityRegisterCar.this, \"כרטיס נשמר בהצלחה\", Toast.LENGTH_SHORT).show();\r\n\r\n        if (flagEdit) {\r\n            deleteCard();\r\n            return;\r\n        }\r\n\r\n        progressDialog.dismiss();\r\n        Intent intent = new Intent(MainActivityRegisterCar.this, MainActivityPageUser.class);\r\n        startActivity(intent);\r\n\r\n\r\n    }\r\n\r\n    // finish();\r\n    //}\r\n\r\n\r\n    private void setCard() {\r\n        Bundle bundle = getIntent().getExtras();\r\n        cardCarEdit.setKey(bundle.getString(\"key\"));\r\n        cardCarEdit.setEmail(bundle.getString(\"email\"));\r\n        cardCarEdit.setArea(bundle.getString(\"area\"));\r\n        cardCarEdit.setNumImage(bundle.getInt(\"numImage\"));\r\n        cardCarEdit.setCity(bundle.getString(\"city\"));\r\n        cardCarEdit.setPhone(bundle.getString(\"phone\"));\r\n        cardCarEdit.setYearCar(bundle.getString(\"yearCar\"));\r\n        cardCarEdit.setTypeCar(bundle.getString(\"typeCar\"));\r\n        cardCarEdit.setRemarks(bundle.getString(\"remarks\"));\r\n        cardCarEdit.setPriceDay(bundle.getString(\"priceDay\"));\r\n        cardCarEdit.setDateEnd(bundle.getString(\"dateEnd\"));\r\n        cardCarEdit.setDateStart(bundle.getString(\"dateStart\"));\r\n        cardCarEdit.setName(bundle.getString(\"name\"));\r\n        cardCarEdit.setInsurance(bundle.getString(\"insurance\"));\r\n        cardCarEdit.setId(bundle.getInt(\"id\"));\r\n        cardCarEdit.setPermissionToPublish(bundle.getInt(\"permissionToPublish\"));\r\n        cardCarEdit.setRejection(bundle.getString(\"rejection\"));\r\n\r\n        for (int i = 1; i <= cardCarEdit.getNumImage(); i++)\r\n            cardCarEdit.addImageViewArrayListName(bundle.getString(\"image\" + i));\r\n\r\n    }\r\n\r\n    public void deleteCard() {\r\n\r\n//        mDatabase = FirebaseDatabase.getInstance().getReference(\"RegisterInformation\");\r\n//\r\n//        cardRef2 = FirebaseDatabase.getInstance().getReference(\"RegisterInformation\");\r\n//\r\n//        cardRef2.orderByChild(\"email\").equalTo(email).addListenerForSingleValueEvent(new ValueEventListener() {\r\n//            @Override\r\n//            public void onDataChange(@NonNull DataSnapshot dataSnapshot) {\r\n//                for (DataSnapshot child : dataSnapshot.getChildren()) {\r\n//                    registerInformation = child.getValue(RegisterInformation.class);\r\n//                    key = child.getKey();\r\n//\r\n//                }\r\n//\r\n//                for (int i = 0; i < registerInformation.getCardsUser().size(); i++) {\r\n//                    if (cardCarEdit.getId() == registerInformation.getCardsUser().get(i).getId()) {\r\n//                        registerInformation.removeCardCar(i);\r\n//                        // Toast.makeText(MainActivityRegisterCar.this, key, Toast.LENGTH_SHORT).show();\r\n//                        break;\r\n//                    }\r\n//                }\r\n//\r\n//                mDatabase.child(key).setValue(registerInformation);\r\n        if (cardCarEdit.getPermissionToPublish() == 0) {\r\n            DatabaseReference ref2 = FirebaseDatabase.getInstance().getReference(\"CardsWaitApprov\");\r\n            ref2.child(cardCarEdit.getKey()).removeValue();\r\n        } else if (cardCarEdit.getPermissionToPublish() == 1) {\r\n            DatabaseReference ref2 = FirebaseDatabase.getInstance().getReference(\"CardsApprov\");\r\n            ref2.child(cardCarEdit.getKey()).removeValue();\r\n        } else if (cardCarEdit.getPermissionToPublish() == 2) {\r\n            DatabaseReference ref2 = FirebaseDatabase.getInstance().getReference(\"CardsRejection\");\r\n            ref2.child(cardCarEdit.getKey()).removeValue();\r\n        }\r\n        progressDialog.dismiss();\r\n        Intent intent = new Intent(MainActivityRegisterCar.this, MainActivityPageUser.class);\r\n        startActivity(intent);\r\n\r\n//            }\r\n//\r\n//            @Override\r\n//            public void onCancelled(@NonNull DatabaseError databaseError) {\r\n//\r\n//            }\r\n//        });\r\n\r\n    }\r\n\r\n    @Override\r\n    public boolean onCreateOptionsMenu(Menu menu) {\r\n        MenuInflater menuInflater = getMenuInflater();\r\n        menuInflater.inflate(R.menu.menu_app, menu);\r\n        return true;\r\n    }\r\n\r\n    @Override\r\n    public boolean onOptionsItemSelected(@NonNull MenuItem item) {\r\n        Intent intent2;\r\n        switch (item.getItemId()) {\r\n            case R.id.mainMenu:\r\n                intent2 = new Intent(MainActivityRegisterCar.this, MainActivity.class);\r\n                startActivity(intent2);\r\n                return true;\r\n            case R.id.mainIconMenu:\r\n                intent2 = new Intent(MainActivityRegisterCar.this, MainActivity.class);\r\n                startActivity(intent2);\r\n                return true;\r\n            case R.id.myPageMenu:\r\n                intent2 = new Intent(MainActivityRegisterCar.this, MainActivityPageUser.class);\r\n                startActivity(intent2);\r\n                return true;\r\n            case R.id.cardCarMenu:\r\n                intent2 = new Intent(MainActivityRegisterCar.this, MainActivityRegisterCar.class);\r\n                startActivity(intent2);\r\n                return true;\r\n            default:\r\n                return super.onOptionsItemSelected(item);\r\n        }\r\n    }\r\n\r\n    private void dialogeImageDeleteConfirmation() {\r\n        final Dialog d = new Dialog(this);\r\n        d.setContentView(R.layout.dialog_image_delete);\r\n        d.setTitle(\"Image delete confirmation\");\r\n\r\n        d.setCancelable(true);\r\n        Button buttonYes = (Button) d.findViewById(R.id.buttonYes);\r\n        Button buttonNo = (Button) d.findViewById(R.id.buttonNo);\r\n        buttonYes.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View view) {\r\n                flagImageDeleteConfirmation = 1;\r\n                imageView1.setImageResource(R.drawable.ic_car);\r\n                imageView2.setImageResource(R.drawable.ic_car);\r\n                imageView3.setImageResource(R.drawable.ic_car);\r\n                imageView4.setImageResource(R.drawable.ic_car);\r\n                cardCar.setImageViewArrayListName(new ArrayList<String>());\r\n                d.dismiss();\r\n            }\r\n        });\r\n        buttonNo.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View view) {\r\n                flagImageDeleteConfirmation = 2;\r\n                d.dismiss();\r\n\r\n            }\r\n        });\r\n        d.show();\r\n\r\n    }\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/com/example/rentit/MainActivityRegisterCar.java	(revision 664d3e848934120587779752379519a5ef3841a4)
+++ app/src/main/java/com/example/rentit/MainActivityRegisterCar.java	(date 1609895543727)
@@ -59,7 +59,7 @@
 public class MainActivityRegisterCar extends AppCompatActivity {
     private RegisterInformation registerInformation;
 
-
+    
     private DatabaseReference cardRef2;
     private DatabaseReference cardRef;
 
